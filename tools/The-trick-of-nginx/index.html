<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Nginx使用说明 | cv-programmer</title><meta name="keywords" content="Linux,nginx"><meta name="author" content="cv-programmer"><meta name="copyright" content="cv-programmer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="安装 分发版本安装 12sudo apt updatesudo apt-get install nginx  docker安装  编译安装   基础知识基础命令 启动Nginx：nginx  查看版本：nginx -v   等所有进程停止后退出Nginx ：nginx -s quit  暴力退出Nginx ：nginx -s stop  重新加载配置文件（热更新）：nginx -s reload">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx使用说明">
<meta property="og:url" content="http://bh.ecel.top/tools/The-trick-of-nginx/index.html">
<meta property="og:site_name" content="cv-programmer">
<meta property="og:description" content="安装 分发版本安装 12sudo apt updatesudo apt-get install nginx  docker安装  编译安装   基础知识基础命令 启动Nginx：nginx  查看版本：nginx -v   等所有进程停止后退出Nginx ：nginx -s quit  暴力退出Nginx ：nginx -s stop  重新加载配置文件（热更新）：nginx -s reload">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://bh.ecel.top/image/nginx.png">
<meta property="article:published_time" content="2023-04-10T13:53:11.000Z">
<meta property="article:modified_time" content="2024-08-31T14:32:14.362Z">
<meta property="article:author" content="cv-programmer">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="nginx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://bh.ecel.top/image/nginx.png"><link rel="shortcut icon" href="/image/avatar.jpg"><link rel="canonical" href="http://bh.ecel.top/tools/The-trick-of-nginx/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":10,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-31 22:32:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/image/avatar.jpg" onerror="onerror=null;src='/image/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">91</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">124</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-lock"></i><span> 个人</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/timerest/"><i class="fa-fw fas fa-warning"></i><span> 倒计时</span></a></li><li><a class="site-page" href="/myweb/"><i class="fa-fw fas fa-database"></i><span> 网站</span></a></li><li><a class="site-page" href="/blogs/"><i class="fa-fw fas fa-file-text"></i><span> 博文</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/image/nginx.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">cv-programmer</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-lock"></i><span> 个人</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/timerest/"><i class="fa-fw fas fa-warning"></i><span> 倒计时</span></a></li><li><a class="site-page" href="/myweb/"><i class="fa-fw fas fa-database"></i><span> 网站</span></a></li><li><a class="site-page" href="/blogs/"><i class="fa-fw fas fa-file-text"></i><span> 博文</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Nginx使用说明</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-10T13:53:11.000Z" title="发表于 2023-04-10 21:53:11">2023-04-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-31T14:32:14.362Z" title="更新于 2024-08-31 22:32:14">2024-08-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ul>
<li><p>分发版本安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt-get install nginx</span><br></pre></td></tr></table></figure>
</li>
<li><p><del>docker安装</del></p>
</li>
<li><p><del>编译安装</del></p>
</li>
</ul>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><ul>
<li><p>启动<code>Nginx</code>：<code>nginx</code></p>
</li>
<li><p>查看版本：<code>nginx -v</code></p>
<p><img src="/tools/The-trick-of-nginx/image-20230422160713618.png" alt="image-20230422160713618"></p>
</li>
<li><p>等所有进程停止后退出<code>Nginx</code> ：<code>nginx -s quit</code></p>
</li>
<li><p>暴力退出<code>Nginx</code> ：<code>nginx -s stop</code></p>
</li>
<li><p>重新加载配置文件（热更新）：<code>nginx -s reload</code></p>
</li>
<li><p>测试配置文件：<code>nginx -t</code></p>
</li>
</ul>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><ul>
<li>以<code>Ubuntu 20.04</code>使用<code>apt</code>安装<code>nginx.1.18.0(Ubuntu)</code>为例，不同版本可能不完全一致，但相似</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── conf.d					# 用户自己定义的conf配置文件</span><br><span class="line">├── fastcgi.conf			# fastcgi相关参数，cgi与fastcgi关系可查看参考4（What is CGI, FastCGI?）</span><br><span class="line">├── fastcgi_params			# fastcgi相关参数，与fastcgi.conf	区别如后所示</span><br><span class="line">├── koi-utf					# 编码转换映射文件, charset_map  koi8-r &lt; -- &gt; utf-8</span><br><span class="line">├── koi-win					# 编码转换映射文件, charset_map  koi8-r &lt; -- &gt; windows-1251</span><br><span class="line">├── mime.types				# 文件扩展名与文件类型映射表，nginx根据映射关系，设置http请求响应头的Content-Type值</span><br><span class="line">├── modules-available		# 可用模块配置</span><br><span class="line">├── modules-enabled			# 启用模块配置</span><br><span class="line">│   ├── 50-mod-http-image-filter.conf -&gt; /usr/share/nginx/modules-available/mod-http-image-filter.conf</span><br><span class="line">│   ├── 50-mod-http-xslt-filter.conf -&gt; /usr/share/nginx/modules-available/mod-http-xslt-filter.conf</span><br><span class="line">│   ├── 50-mod-mail.conf -&gt; /usr/share/nginx/modules-available/mod-mail.conf</span><br><span class="line">│   └── 50-mod-stream.conf -&gt; /usr/share/nginx/modules-available/mod-stream.conf</span><br><span class="line">├── nginx.conf				# 主配置文件（全局配置）</span><br><span class="line">├── proxy_params			# proxy相关参数</span><br><span class="line">├── scgi_params				# scgi相关参数</span><br><span class="line">├── sites-available			# 可用网站配置，系统默认设置的配置文件</span><br><span class="line">│   └── default</span><br><span class="line">├── sites-enabled			# 启用网站配置，由sites-available中的配置文件转换生成</span><br><span class="line">│   └── default -&gt; /etc/nginx/sites-available/default</span><br><span class="line">├── snippets				# 重复的配置可放在这里，被其他文件引用</span><br><span class="line">│   ├── fastcgi-php.conf</span><br><span class="line">│   └── snakeoil.conf</span><br><span class="line">├── uwsgi_params			# uwsgi相关参数</span><br><span class="line">└── win-utf					# 编码转换映射文件, charset_map  windows-1251 &lt; -- &gt; utf-8</span><br></pre></td></tr></table></figure>

<h2 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h2><ul>
<li><code>$args</code> ：这个变量等于请求行中的参数，同 <code>$query_string</code></li>
<li><code>$content_length</code> ：请求头中的 Content-length 字段</li>
<li><code>$content_type</code> ：请求头中的 Content-Type 字段</li>
<li><code>$document_root</code> ：当前请求在 root 指令中指定的值</li>
<li><code>$host</code> ：请求行的主机名，为空则为请求头字段 Host 中的主机名，再为空则与请求匹配的 server_name</li>
<li><code>$http_host</code> ： <code>$host</code>加端口</li>
<li><code>$http_user_agent</code> ：客户端 agent 信息</li>
<li><code>$http_cookie</code> ：客户端 cookie 信息</li>
<li><code>$limit_rate</code> ：这个变量可以限制连接速率</li>
<li><code>$request_method</code> ：客户端请求的动作，通常为 GET 或 POST</li>
<li><code>$remote_addr</code> ：客户端的 IP 地址</li>
<li><code>$remote_port</code> ：客户端的端口</li>
<li><code>$remote_user</code> ：已经经过 Auth Basic Module 验证的用户名。</li>
<li><code>$request_filename</code> ：当前请求的文件路径，由 root 或 alias 指令与 URI 请求生成</li>
<li><code>$scheme</code> ：HTTP 方法（如 http，https）</li>
<li><code>$server_protocol</code> ：请求使用的协议，通常是 HTTP&#x2F;1.0 或 HTTP&#x2F;1.1</li>
<li><code>$server_addr</code> ：服务器地址，在完成一次系统调用后可以确定这个值</li>
<li><code>$server_name</code> ：服务器名称</li>
<li><code>$server_port</code> ：请求到达服务器的端口号</li>
<li><code>$request_uri</code> ：包含请求参数的原始 URI，不包含主机名，如：”&#x2F;foo&#x2F;bar.php?arg&#x3D;baz”</li>
<li><code>$uri</code> ：不带请求参数的当前 URI，$uri 不包含主机名，如”&#x2F;foo&#x2F;bar.html”</li>
<li><code>$document_uri</code> ：与 $uri 相同</li>
</ul>
<h2 id="配置文件介绍"><a href="#配置文件介绍" class="headerlink" title="配置文件介绍"></a>配置文件介绍</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li><p>分为四个部分</p>
<ul>
<li>全局配置：影响<code>Nginx</code>服务器全局 ，一般配置<code>worker</code>数量，错误日志等 </li>
<li><code>events</code>配置：负责<code>Nginx</code>与客户端的网络连接，如配置网络<code>IO</code>模型，配置单个<code>worker</code>支持的最大连接数等</li>
<li><code>http</code>模块：<strong>主要配置部分</strong>，配置请求转发，反向代理等的地方</li>
<li><code>virtual hosts</code>模块：通过虚拟主机将不同的配置进行隔离</li>
</ul>
<p><img src="/tools/The-trick-of-nginx/image-20230410220600668.png" alt="image-20230410220600668"></p>
</li>
</ul>
<h3 id="配置文件详解"><a href="#配置文件详解" class="headerlink" title="配置文件详解"></a>配置文件详解</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######## global ########</span></span><br><span class="line"><span class="comment"># 配置Nginx运行时的用户及用户组</span></span><br><span class="line"><span class="comment"># 默认为nobody nobody</span></span><br><span class="line"><span class="attribute">user</span> www www;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置worker进程数量</span></span><br><span class="line"><span class="comment"># 根据CPU数量设置</span></span><br><span class="line"><span class="comment"># 默认数量为1，可以设置为auto来自动设置</span></span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置erro_log路径及级别，可以设置记录多个级别的信息</span></span><br><span class="line"><span class="comment"># 级别：debug|info|notice|warn|error|crit|alert|emerg</span></span><br><span class="line"><span class="attribute">error_log</span> /var/log/nginx/<span class="literal">error</span>.log <span class="literal">info</span>;</span><br><span class="line"><span class="attribute">error_log</span> /var/log/nginx/<span class="literal">error</span>.log <span class="literal">debug</span>;</span><br><span class="line"><span class="attribute">error_log</span> /var/log/nginx/<span class="literal">error</span>.log <span class="literal">error</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程文件地址，记录了主进程的进程ID</span></span><br><span class="line"><span class="attribute">pid</span>        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定每个worker能够打开的文件描述符最大数量</span></span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">65535</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######## events ########</span></span><br><span class="line">events &#123;</span><br><span class="line">    <span class="comment"># 设置网路连接序列化，防止惊群现象发生，默认为on</span></span><br><span class="line">    <span class="comment"># accept_mutex on;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置一个进程是否同时接受多个网络连接，默认为off</span></span><br><span class="line">    <span class="comment"># multi_accept on; </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用epoll作为网络通讯模型</span></span><br><span class="line">    <span class="attribute">use</span> <span class="literal">epoll</span>; </span><br><span class="line">    <span class="comment"># 单个worker的最大连接数</span></span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">######## http ########</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># 文件扩展名与文件类型映射表</span></span><br><span class="line">    <span class="comment"># include mime.types;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 默认文件类型，默认为text/plain</span></span><br><span class="line">    <span class="comment"># default_type  application/octet-stream;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 自定义日志格式</span></span><br><span class="line">    <span class="comment"># combined为日志格式的默认值</span></span><br><span class="line">    <span class="comment"># 参考10提到，需要需要开启压缩 gzip on; 否则不生成日志文件（待验证）</span></span><br><span class="line">    <span class="comment"># log_format myFormat &#x27;$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for&#x27;;</span></span><br><span class="line">    <span class="comment"># access_log log/access.log myFormat; </span></span><br><span class="line">    <span class="comment"># gzip on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 以下四个和客户端相关</span></span><br><span class="line">    <span class="comment"># 当客户端发起请求时，Nginx默认会使用client_header_buffer_size作为缓冲区来读取HTTP请求头的信息</span></span><br><span class="line">    <span class="comment"># 当HTTP请求头的信息大小超过1k时，使用large_client_header_buffers作为缓冲区读取</span></span><br><span class="line">    <span class="comment"># 再次超过，则会返回400错误码</span></span><br><span class="line">    <span class="attribute">client_header_buffer_size</span> <span class="number">1k</span>;</span><br><span class="line">    <span class="attribute">large_client_header_buffers</span> <span class="number">21k</span>;</span><br><span class="line">    <span class="comment"># body缓冲区大小，类似上面的头部大小设定</span></span><br><span class="line">    <span class="comment"># 超过client_max_body_size，则会返回413错误码</span></span><br><span class="line">    <span class="attribute">client_body_buffer_size</span> <span class="number">16k</span>;</span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">8m</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 这三个一般配合使用，与网络IO相关</span></span><br><span class="line">    <span class="comment"># 涉及零拷贝，即是否有缓冲区拷贝等</span></span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment"># 优化一次性数据发送量</span></span><br><span class="line">    <span class="attribute">tcp_nopush</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment"># 关闭了网络拥塞算法</span></span><br><span class="line">    <span class="attribute">tcp_nodelay</span> <span class="literal">on</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 同一个连接最大的请求数量，默认100</span></span><br><span class="line">    <span class="attribute">keepalive_requests</span> <span class="number">100000</span>;</span><br><span class="line">    <span class="comment"># 同一个连接存活的时间，单位为秒</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">120</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 错误页</span></span><br><span class="line">    <span class="comment"># error_page 404 https://www.baidu.com; </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">######## virtual hosts ########</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="comment"># 监听端口</span></span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="comment"># 请求域名 多个用空格分隔</span></span><br><span class="line">        <span class="comment"># 可以是：全名，通配符，正则表达式</span></span><br><span class="line">        <span class="attribute">server_name</span> example.org www.example.org;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># location是对server_name更为详细的配置，紧跟通配符或正则表达式</span></span><br><span class="line">        <span class="comment"># 匹配到不同规则，返回不同结果</span></span><br><span class="line">        <span class="comment"># 当请求为图片时，设置了过期时间为10天</span></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span> &#123;</span><br><span class="line">            <span class="attribute">expires</span> <span class="number">10d</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 匹配server_name/</span></span><br><span class="line">        <span class="comment"># 配到到即会返回/usr/share/nginx/html/index.html给客户端</span></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line">            <span class="attribute">index</span> index.html;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># server_name/app</span></span><br><span class="line">        <span class="section">location</span> /app/ &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://127.0.0.1:88;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-FOR <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="location"><a href="#location" class="headerlink" title="location"></a>location</h2><ul>
<li><p>优先级顺序：精确匹配，前缀匹配，正则匹配，普通字符匹配</p>
</li>
<li><p><code>精确匹配（=）</code>：等于，严格匹配，如果找到，立即停止搜索并立即处理此请求</p>
</li>
<li><p><code>前缀匹配（^~）</code>：如果匹配成功，则不再匹配其它 location，<code>^</code>表示 “非”，即不查询正则表达式</p>
</li>
<li><p><code>正则匹配（~和～*）</code>：前者表示<strong>区分大小写</strong>，后者表示<strong>不区分大小写</strong></p>
</li>
<li><p>示例</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /images/ &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://localhost:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> <span class="regexp">~ \.jpg</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://localhost:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>/images/1.jpg</code>代理到 <code>http://localhost:8080/images/1.jpg</code></li>
<li><code>/some/path/1.jpg</code>代理到<code>http://localhost:8080/some/path/1.jpg</code></li>
</ul>
</li>
</ul>
<h2 id="Upstream"><a href="#Upstream" class="headerlink" title="Upstream"></a>Upstream</h2><ul>
<li><p>负载均衡模块</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># 将多个服务器放在cluster1集群中</span></span><br><span class="line">    <span class="section">upstream</span> cluster1 &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.1.163:8080</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.1.164:8080</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.1.165:8080</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="comment"># 匹配到时，讲请求转发到cluster1集群中</span></span><br><span class="line">        <span class="comment"># 具体分配根据负载均衡策略进行分配</span></span><br><span class="line">        <span class="section">location</span> /app1/ &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http:ss//cluster1/;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>负载均衡策略</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 轮询，默认方式，按照时间顺序一个个分配</span></span><br><span class="line"><span class="comment"># 如果有服务器下线，Nginx会自动提出下线服务器</span></span><br><span class="line"><span class="section">upstream</span> cluster1 &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.163:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.164:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.165:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># weight</span></span><br><span class="line"><span class="comment"># 权重越高，分配的请求越多</span></span><br><span class="line"><span class="section">upstream</span> cluster1 &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.163:8080</span> weight = <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.164:8080</span> weight = <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.165:8080</span> weight = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ip_hash</span></span><br><span class="line"><span class="comment"># 根据客户端的IP来固定选择分配的服务器</span></span><br><span class="line"><span class="section">upstream</span> cluster1 &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.163:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.164:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.165:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># hash</span></span><br><span class="line"><span class="comment"># 通用hash，允许用户自定义hash的key，key可以是字符串、变量或组合</span></span><br><span class="line"><span class="comment"># 例如，key可以是配对的源 IP 地址和端口，也可以是 URI</span></span><br><span class="line"><span class="comment"># consistent参数启用 ketama一致哈希算法</span></span><br><span class="line"><span class="section">upstream</span> backend &#123;</span><br><span class="line">    <span class="attribute">hash</span> <span class="variable">$request_uri</span> consistent;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.163:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.164:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.165:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最小连接</span></span><br><span class="line"><span class="comment"># 将下一个请求分配给活动连接数最少的服务器（较为空闲的服务器）</span></span><br><span class="line"><span class="section">upstream</span> backend &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.163:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.164:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.165:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机</span></span><br><span class="line"><span class="comment"># 每个请求都将传递到随机选择的服务器</span></span><br><span class="line"><span class="comment"># two是可选参数，NGINX 在考虑服务器权重的情况下随机选择两台服务器，然后使用指定的方法选择其中一台，默认为选择连接数最少（least_conn）的服务器</span></span><br><span class="line"><span class="section">upstream</span> backend &#123;</span><br><span class="line">    <span class="attribute">random</span> two least_conn;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.163:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.164:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.165:8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 健康检查</span></span><br><span class="line"><span class="comment"># 在反向代理中，如果后端服务器在某个周期内响应失败次数超过规定值，nginx会将此服务器标记为失败，并在之后的一个周期不再将请求发送给这台服务器</span></span><br><span class="line"><span class="comment"># 通过fail_timeout来设置检查周期，默认为10秒</span></span><br><span class="line"><span class="comment"># 通过max_fails来设置检查失败次数，默认为1次</span></span><br><span class="line"><span class="section">upstream</span> backend &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.163:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.164:8080</span>; max_fails=3 fail_timeout=30s; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="try-files"><a href="#try-files" class="headerlink" title="try_files"></a>try_files</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#try_files">try_files</a>：可用于检查<strong>指定的文件或目录是否存在</strong>，如果不存在，则重定向到指定位置</p>
</li>
<li><p>如下，如果原始URI对应的文件不存在，NGINX将内部重定向到<code>/www/data/images/default.gif</code></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">root</span> /www/data;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /images/ &#123;</span><br><span class="line">        <span class="comment"># 最后一个参数也可以是状态代码（状态码之前需要加上等号）</span></span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> /images/default.gif;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ <span class="variable">$uri</span>.html =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果原始 URI 和附加尾随斜杠的 URI 都没有解析到现有文件或目录中，则请求将重定向到命名位置，该位置会将其传递到代理服务器</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">    	<span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ <span class="variable">@backend</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="variable">@backend</span> &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://backend.example.com;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="return与rewrite"><a href="#return与rewrite" class="headerlink" title="return与rewrite"></a>return与rewrite</h2><h3 id="return"><a href="#return" class="headerlink" title="return"></a>return</h3><ul>
<li><p>服务端停止处理并将状态码<code>status code</code>返回给客户端</p>
<ul>
<li><code>return code URL</code></li>
<li><code>return code text</code></li>
<li><code>return code</code></li>
<li><code>return URL</code></li>
</ul>
</li>
<li><p>强制所有请求使用<code>HTTPS</code></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 错误写法</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8003</span>;</span><br><span class="line">    <span class="attribute">server_name</span> a.hello.com</span><br><span class="line"></span><br><span class="line">    return <span class="number">301</span> https://localhost:8004;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确写法</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8003</span>;</span><br><span class="line">    <span class="attribute">server_name</span> a.hello.com</span><br><span class="line"></span><br><span class="line">    return <span class="number">301</span> https://192.168.56.105:8004;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 原因在于return是重定向，而proxy_pass是转发，因此使用return时不能使用localhost</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h3><ul>
<li><p>如果指定的正则表达式与请求 URI 匹配，则 URI 将按照字符串中的指定进行更改。指令按其在配置文件中出现的先后顺序执行</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(/download/.*)/media/(\w+)\.?.*$</span> <span class="variable">$1</span>/mp3/<span class="variable">$2</span>.mp3 <span class="literal">last</span>;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(/download/.*)/audio/(\w+)\.?.*$</span> <span class="variable">$1</span>/mp3/<span class="variable">$2</span>.ra  <span class="literal">last</span>;</span><br><span class="line">    <span class="attribute">return</span>  <span class="number">403</span>;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>上面是使用该指令的示例 NGINX 重写规则。它匹配以字符串 <code>/download</code> 开头的 URL，然后在路径后面的某个位置包含 <code>/media/</code> 或 <code>/audio/</code> 目录</li>
<li>它将这些元素替换为 <code>/mp3/</code>，并添加相应的文件扩展名，<code>.mp3</code>或 <code>.ra</code>。和 变量捕获未更改的路径元素</li>
<li>例如<ul>
<li><code>/download/cdn-west/media/file1</code> 变成了 <code>/download/cdn-west/mp3/file1.mp3</code></li>
<li>如果文件名上有扩展名（如 <code>.flv</code>），则表达式会将其剥离，并将其替换为<code>.mp3</code></li>
</ul>
</li>
</ul>
</li>
<li><p>如果字符串包含新的请求参数，则以前的请求参数将追加到这些参数之后。如果不需要这样做，则在替换字符串的末尾放置一个问号可以避免附加它们</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/users/(.*)$</span> /show?user=<span class="variable">$1</span>? <span class="literal">last</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="last与break"><a href="#last与break" class="headerlink" title="last与break"></a>last与break</h2><ul>
<li><code>last</code>：如果当前规则匹配，停止处理后续rewrite规则，使用重写后的路径，重新搜索<code>location及其块内</code>指令</li>
<li><code>break</code>:如果当前规则匹配，停止处理后续rewrite规则，执行<code>&#123;&#125;块</code>内其他指令</li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="概述及使用建议"><a href="#概述及使用建议" class="headerlink" title="概述及使用建议"></a>概述及使用建议</h2><h3 id="conf-d和sites-available"><a href="#conf-d和sites-available" class="headerlink" title="conf.d和sites-available"></a>conf.d和sites-available</h3><ul>
<li>直接在<code>conf.d</code>里面配置<code>xx.conf</code>比在<code>sites-available</code>中配置，再添加超链接到<code>sites-enabled</code>中方便</li>
</ul>
<h3 id="重复的配置可继承自父级"><a href="#重复的配置可继承自父级" class="headerlink" title="重复的配置可继承自父级"></a>重复的配置可继承自父级</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推荐</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">    <span class="attribute">root</span> /var/www/nginx-default/;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># root继承父级配置</span></span><br><span class="line">        <span class="comment"># [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">location</span> /foo &#123;</span><br><span class="line">        <span class="comment"># root继承父级配置</span></span><br><span class="line">        <span class="comment"># [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">location</span> /bar &#123;</span><br><span class="line">        <span class="comment"># 覆盖</span></span><br><span class="line">        <span class="attribute">root</span> /some/other/place;</span><br><span class="line">        <span class="comment"># [...]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不推荐</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">  </span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">root</span> /var/www/nginx-default/;</span><br><span class="line">    <span class="comment"># [...]</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="section">location</span> /foo &#123;</span><br><span class="line">    <span class="attribute">root</span> /var/www/nginx-default/;</span><br><span class="line">    <span class="comment"># [...]</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="section">location</span> /bar &#123;</span><br><span class="line">    <span class="attribute">root</span> /some/other/place;</span><br><span class="line">  <span class="comment"># [...]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="不要将所有请求都代理到后端服务器（动静分离）"><a href="#不要将所有请求都代理到后端服务器（动静分离）" class="headerlink" title="不要将所有请求都代理到后端服务器（动静分离）"></a>不要将所有请求都代理到后端服务器（动静分离）</h3><ul>
<li>考虑到很多请求是访问静态内容（如图片，css，javascript等文件）,可以使用缓存或者配置静态目录来减少发送到后端的请求数量，这样可以减小后端服务器的开销</li>
</ul>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推荐</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8002</span>;</span><br><span class="line">    <span class="attribute">server_name</span> ruoyi.tomcat;</span><br><span class="line">    <span class="attribute">root</span> /home/www/static;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ <span class="variable">@proxy</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="variable">@proxy</span> &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8080;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不推荐</span></span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://localhost:8088;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查文件是否存在使用try-files代替if-f"><a href="#检查文件是否存在使用try-files代替if-f" class="headerlink" title="检查文件是否存在使用try_files代替if -f"></a>检查文件是否存在使用try_files代替if -f</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推荐</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">root</span> /var/www/example.com;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不推荐</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">root</span> /var/www/example.com;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">if</span> (!-f <span class="variable">$request_filename</span>) &#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在重写路径中包含http-或https"><a href="#在重写路径中包含http-或https" class="headerlink" title="在重写路径中包含http:&#x2F;&#x2F;或https:&#x2F;&#x2F;"></a>在重写路径中包含http:&#x2F;&#x2F;或https:&#x2F;&#x2F;</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推荐</span></span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^</span> http://example.com <span class="literal">permanent</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 不推荐</span></span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^</span> example.com <span class="literal">permanent</span>; </span><br></pre></td></tr></table></figure>

<h2 id="通过域名访问（反向代理）"><a href="#通过域名访问（反向代理）" class="headerlink" title="通过域名访问（反向代理）"></a>通过域名访问（反向代理）</h2><h3 id="HTTP代理"><a href="#HTTP代理" class="headerlink" title="HTTP代理"></a>HTTP代理</h3><ul>
<li><p>直接在浏览器输入域名即可访问同一服务器部署的不同网站，<strong>不需要显示输入端口</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span> default_server; 					<span class="comment"># 监听端口</span></span><br><span class="line">        <span class="attribute">root</span> /mnt/aa; 								<span class="comment"># 访问根目录</span></span><br><span class="line">        <span class="attribute">index</span> index.html index.htm; 				<span class="comment"># 默认页,可以不设置</span></span><br><span class="line">        <span class="attribute">server_name</span> www.hello.com; 				<span class="comment"># 根据域名跳转</span></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://127.0.0.1:8081;  	<span class="comment"># 跳转的路径</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;									<span class="comment"># 监听端口</span></span><br><span class="line">        <span class="attribute">root</span> /mnt/bb;</span><br><span class="line">        <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">        <span class="attribute">server_name</span> bs.hello.com;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">                <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://127.0.0.1:8082; 	<span class="comment"># 另一个路径</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果proxy-pass的地址包括/或其他路径，那么/some/path将会被替换</span></span><br><span class="line"><span class="comment"># 如下所示，访问 http://localhost/some/path/page.html 将被代理到 http://localhost:8080/zh-cn/page.html</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;									<span class="comment"># 监听端口</span></span><br><span class="line">        <span class="attribute">server_name</span> <span class="number">1</span>.hello.com;</span><br><span class="line">        <span class="section">location</span> /some/path/ &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://localhost:8080/zh-cn/;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于使用反向代理之后，后端服务无法获取用户的真实IP，所以，一般反向代理都会设置以下header信息</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /some/path/ &#123;</span><br><span class="line">    <span class="comment">#nginx的主机地址</span></span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="comment">#用户端真实的IP，即客户端IP</span></span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">proxy_pass</span> http://localhost:8088;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>常用变量的值</p>
<ul>
<li><code>$host</code>：nginx主机IP，例如192.168.56.105</li>
<li><code>$http_host</code>：nginx主机IP和端口，192.168.56.105:8001</li>
<li><code>$proxy_host</code>：localhost:8088，proxy_pass里配置的主机名和端口</li>
<li><code>$remote_addr</code>:用户的真实IP，即客户端IP。</li>
</ul>
</li>
</ul>
<h3 id="非HTTP代理"><a href="#非HTTP代理" class="headerlink" title="非HTTP代理"></a>非HTTP代理</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_pass">fastcgi_pass</a>：将请求转发到FastCGI服务器（多用于PHP）</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_scgi_module.html#scgi_pass">scgi_pass</a>：将请求转发到SCGI server服务器（多用于PHP）</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_uwsgi_module.html#uwsgi_pass">uwsgi_pass</a>：将请求转发到uwsgi服务器（多用于python）</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_memcached_module.html#memcached_pass">memcached_pass</a>：将请求转发到memcached服务器</p>
</li>
<li><p>TCP反向代理：与<code>HTTP</code>反向代理同级，需要修改<code>nginx.conf</code>文件</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HTTP代理</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">  <span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8002</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://localhost:8080/;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP代理</span></span><br><span class="line"><span class="section">stream</span> &#123;</span><br><span class="line">  <span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">13306</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> localhost:<span class="number">3306</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="SSL设置（HTTPS）"><a href="#SSL设置（HTTPS）" class="headerlink" title="SSL设置（HTTPS）"></a>SSL设置（HTTPS）</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> www.hello.com;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">ssl_certificate</span> [证书公钥路径];</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> [证书密钥路径];</span><br><span class="line">    <span class="comment"># 如果设置了密码，需要加上</span></span><br><span class="line">    <span class="comment"># ssl_password_file   /home/ssl/cert.pass;</span></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="comment"># 表示使用的加密套件的类型</span></span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="comment"># 表示使用的TLS协议的类型</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>; </span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">		<span class="attribute">root</span> /mnt/cc;   <span class="comment">#站点目录</span></span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="允许与禁止IP"><a href="#允许与禁止IP" class="headerlink" title="允许与禁止IP"></a>允许与禁止IP</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">allow</span> <span class="number">12.12.12.22</span>  <span class="comment"># 允许访问</span></span><br><span class="line">deny <span class="number">223.104.123.12</span>; <span class="comment"># 禁止访问</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">deny</span> <span class="number">123.0.0.0</span>/<span class="number">8</span>;   <span class="comment"># 封 123.0.0.1~123.255.255.254 这个段的ip</span></span><br><span class="line"><span class="attribute">deny</span> <span class="number">123.1.0.0</span>/<span class="number">16</span>;  <span class="comment"># 封 123.1.0.1~123.1.255.254 这个段的ip</span></span><br><span class="line"><span class="attribute">deny</span> <span class="number">123.1.1.0</span>/<span class="number">24</span>;	<span class="comment"># 封 123.1.1.1~123.1.1.254 这个段的ip</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">deny</span> all;   		<span class="comment"># 除allow的IP地址外，其他的IP地址都禁止访问</span></span><br></pre></td></tr></table></figure>

<h2 id="域名迁移，不让用户收藏的链接或者搜索引擎的链接失效"><a href="#域名迁移，不让用户收藏的链接或者搜索引擎的链接失效" class="headerlink" title="域名迁移，不让用户收藏的链接或者搜索引擎的链接失效"></a>域名迁移，不让用户收藏的链接或者搜索引擎的链接失效</h2><ul>
<li><p>将请求从 <code>www.old-name.com </code> 和<code>old-name.com</code>永久重定向到 <code>www.new-name.com</code>，包含http和https请求</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> www.old-name.com old-name.com;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> <span class="variable">$scheme</span>://www.new-name.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="答疑"><a href="#答疑" class="headerlink" title="答疑"></a>答疑</h1><h2 id="fastcgi-params和fastcgi-conf的区别"><a href="#fastcgi-params和fastcgi-conf的区别" class="headerlink" title="fastcgi_params和fastcgi.conf的区别"></a>fastcgi_params和fastcgi.conf的区别</h2><ol>
<li><p>两者的差异</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fastcgi.conf只比fastcgi_params多了一行</span></span><br><span class="line">fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;</span><br></pre></td></tr></table></figure>
</li>
<li><p>原本只有<code>fastcgi_params</code>文件，<code>fastcgi.conf</code>是<code>nginx 0.8.30</code> 才引入的，主要为是解决部分人在定义<code>SCRIPT_FILENAME</code>时采用<strong>硬编码</strong>的方式，如<code>fastcgi_param  SCRIPT_FILENAME  /var/www/foo$fastcgi_script_name</code>，于是<strong>为了规范用法</strong>便引入了<code>fastcgi.conf</code></p>
</li>
<li><p>为什么要引入新文件，而不是在旧的文件上改造？</p>
<ul>
<li>这是因为<code>fastcgi_param</code>指令是<strong>数组型</strong>的<ul>
<li>和普通指令相同的是：内层替换外层；</li>
<li>和普通指令不同的是：当在同级多次使用的时候，是新增而不是替换</li>
</ul>
</li>
<li>换句话说，如果在同级定义两次<code>SCRIPT_FILENAME</code>，那么它们都会被发送到后端，这可能会导致一些潜在的问题，为了避免此类情况，便引入了一个新的配置文件</li>
</ul>
</li>
<li><p>推荐使用：<code>fastcgi.conf</code></p>
</li>
</ol>
<h2 id="转发和重定向"><a href="#转发和重定向" class="headerlink" title="转发和重定向"></a>转发和重定向</h2><ul>
<li><p>转发是服务端行为，重定向是客户端行为</p>
</li>
<li><p>转发：反向代理<code>proxy_pass</code>属于转发，浏览器的访问栏输入的地址不会发生变化</p>
<p><img src="/tools/The-trick-of-nginx/1660027681278-8d232df3-69f1-4bb7-ae31-70dab5777cb7.png" alt="截屏2022-08-09 下午2.47.52.png"></p>
</li>
<li><p>重定向：<code>return</code>，<code>rewrite</code>属于重定向，在客户端进行。浏览器的访问栏输入的地址会发生变化</p>
<p><img src="/tools/The-trick-of-nginx/1660014580821-4eae68ec-ecf6-45ef-a5a7-4e33a77efec9.png" alt="截屏2022-08-09 上午11.09.32.png"></p>
</li>
</ul>
<h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><ol>
<li>正确的配置未生效，请清除浏览器缓存<ul>
<li>当你确定修改的配置的正确的，但是未生效，请清除浏览器缓存或者禁用浏览器缓存</li>
</ul>
</li>
<li>在<code>HTTPS</code>中<strong>不启用</strong> <code>SSLv3</code><ul>
<li>由于 SSLv3 中存在 <code>POODLE</code> 漏洞，建议不要在启用了 SSL 的站点中使用 SSLv3</li>
<li>规则：<code>ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</code></li>
</ul>
</li>
<li>不要将 root 目录配置成 <code>/</code>或 <code>/root</code></li>
<li>谨慎使用<code>chmod 777</code><ul>
<li>可以使用<code>namei -om /path/to/check</code>显示路径上的所有权限，并找到问题的根本原因</li>
</ul>
</li>
</ol>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="默认文件"><a href="#默认文件" class="headerlink" title="默认文件"></a>默认文件</h2><h3 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> www-data;</span><br><span class="line"><span class="attribute">worker_processes</span> auto;</span><br><span class="line"><span class="attribute">pid</span> /run/nginx.pid;</span><br><span class="line"><span class="attribute">include</span> /etc/nginx/modules-enabled/<span class="regexp">*.conf</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">768</span>;</span><br><span class="line">    <span class="comment"># multi_accept on;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># Basic Settings</span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nopush</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nodelay</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">65</span>;</span><br><span class="line">    <span class="attribute">types_hash_max_size</span> <span class="number">2048</span>;</span><br><span class="line">    <span class="comment"># server_tokens off;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># server_names_hash_bucket_size 64;</span></span><br><span class="line">    <span class="comment"># server_name_in_redirect off;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span> /etc/nginx/mime.types;</span><br><span class="line">    <span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># SSL Settings</span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>; <span class="comment"># Dropping SSLv3, ref: POODLE</span></span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># Logging Settings</span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/access.log;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># Gzip Settings</span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">	</span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># gzip_vary on;</span></span><br><span class="line">    <span class="comment"># gzip_proxied any;</span></span><br><span class="line">    <span class="comment"># gzip_comp_level 6;</span></span><br><span class="line">    <span class="comment"># gzip_buffers 16 8k;</span></span><br><span class="line">    <span class="comment"># gzip_http_version 1.1;</span></span><br><span class="line">    <span class="comment"># gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line">    <span class="comment"># Virtual Host Configs</span></span><br><span class="line">    <span class="comment">##</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span> /etc/nginx/conf.d/<span class="regexp">*.conf</span>;</span><br><span class="line">    <span class="attribute">include</span> /etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#mail &#123;</span></span><br><span class="line"><span class="comment">#   # See sample authentication script at:</span></span><br><span class="line"><span class="comment">#   # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   # auth_http localhost/auth.php;</span></span><br><span class="line"><span class="comment">#   # pop3_capabilities &quot;TOP&quot; &quot;USER&quot;;</span></span><br><span class="line"><span class="comment">#   # imap_capabilities &quot;IMAP4rev1&quot; &quot;UIDPLUS&quot;;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   server &#123;</span></span><br><span class="line"><span class="comment">#       listen     localhost:110;</span></span><br><span class="line"><span class="comment">#       protocol   pop3;</span></span><br><span class="line"><span class="comment">#       proxy      on;</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   server &#123;</span></span><br><span class="line"><span class="comment">#       listen     localhost:143;</span></span><br><span class="line"><span class="comment">#       protocol   imap;</span></span><br><span class="line"><span class="comment">#       proxy      on;</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="default"><a href="#default" class="headerlink" title="default"></a>default</h3><ul>
<li><code>sites-available/default</code></li>
</ul>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># You should look at the following URL&#x27;s in order to grasp a solid understanding</span></span><br><span class="line"><span class="comment"># of Nginx configuration files in order to fully unleash the power of Nginx.</span></span><br><span class="line"><span class="comment"># https://www.nginx.com/resources/wiki/start/</span></span><br><span class="line"><span class="comment"># https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/</span></span><br><span class="line"><span class="comment"># https://wiki.debian.org/Nginx/DirectoryStructure</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In most cases, administrators will remove this file from sites-enabled/ and</span></span><br><span class="line"><span class="comment"># leave it as reference inside of sites-available where it will continue to be</span></span><br><span class="line"><span class="comment"># updated by the nginx packaging team.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This file will automatically load configuration files provided by other</span></span><br><span class="line"><span class="comment"># applications, such as Drupal or Wordpress. These applications will be made</span></span><br><span class="line"><span class="comment"># available underneath a path with that package name, such as /drupal8.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default server configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span> default_server;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL configuration</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># listen 443 ssl default_server;</span></span><br><span class="line">    <span class="comment"># listen [::]:443 ssl default_server;</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Note: You should disable gzip for SSL traffic.</span></span><br><span class="line">    <span class="comment"># See: https://bugs.debian.org/773332</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Read up on ssl_ciphers to ensure a secure configuration.</span></span><br><span class="line">    <span class="comment"># See: https://bugs.debian.org/765782</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Self signed certs generated by the ssl-cert package</span></span><br><span class="line">    <span class="comment"># Don&#x27;t use them in a production server!</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># include snippets/snakeoil.conf;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> /var/www/html;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add index.php to the list if you are using PHP</span></span><br><span class="line">    <span class="attribute">index</span> index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line">        <span class="comment"># as directory, then fall back to displaying a 404.</span></span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pass PHP scripts to FastCGI server</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">    <span class="comment">#   include snippets/fastcgi-php.conf;</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#   # With php-fpm (or other unix sockets):</span></span><br><span class="line">    <span class="comment">#   fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;</span></span><br><span class="line">    <span class="comment">#   # With php-cgi (or other tcp sockets):</span></span><br><span class="line">    <span class="comment">#   fastcgi_pass 127.0.0.1:9000;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">    <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">    <span class="comment">#   deny all;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Virtual Host configuration for example.com</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can move that to a different file under sites-available/ and symlink that</span></span><br><span class="line"><span class="comment"># to sites-enabled/ to enable it.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#server &#123;</span></span><br><span class="line"><span class="comment">#   listen 80;</span></span><br><span class="line"><span class="comment">#   listen [::]:80;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   server_name example.com;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   root /var/www/example.com;</span></span><br><span class="line"><span class="comment">#   index index.html;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   location / &#123;</span></span><br><span class="line"><span class="comment">#       try_files $uri $uri/ =404;</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="进程模型"><a href="#进程模型" class="headerlink" title="进程模型"></a>进程模型</h2><p><img src="/tools/The-trick-of-nginx/image-20230410220106907.png" alt="image-20230410220106907"></p>
<h1 id="本地测试环境与backup"><a href="#本地测试环境与backup" class="headerlink" title="本地测试环境与backup"></a>本地测试环境与backup</h1><ul>
<li><p>使用<code>podman</code>搭建本地 Nginx 测试环境，<code>docker</code>同理，镜像可见<a target="_blank" rel="noopener" href="https://hub.docker.com/_/nginx">docker:nginx</a></p>
<ul>
<li><p><code>podman</code>启动报错及解决: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/71977532/podman-mount-host-volume-return-error-statfs-no-such-file-or-directory-in-ma">Podman mount host volume return ‘Error: statfs: no such file or directory’ in Mac OS</a></p>
</li>
<li><p>Nginx版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@xxx:/# nginx -v</span><br><span class="line">nginx version: nginx/1.25.3</span><br></pre></td></tr></table></figure>
</li>
<li><p>Nginx.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 并指定自定义 nginx.conf</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">:ro 表示 <span class="built_in">read</span> only</span></span><br><span class="line">podman run --name nginx-test -v ./nginx.conf:/etc/nginx/nginx.conf:ro -p 7890:80 nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx.conf</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用于测试 backup 调度策略</span></span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server x.x.x.x:1234;</span><br><span class="line"></span><br><span class="line">        server x.x.x.x:1235 backup;</span><br><span class="line">        server x.x.x.x:1236 backup;</span><br><span class="line">        server x.x.x.x:1237 backup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>使用 <code>Python</code> 搭建本机简易 webserver</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;Hello, World! Running on port <span class="subst">&#123;app.config[<span class="string">&quot;PORT&quot;</span>]&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;A simple Flask application.&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--port&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, <span class="built_in">help</span>=<span class="string">&quot;The port number to listen on.&quot;</span>, default=<span class="number">1234</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    app.config[<span class="string">&quot;PORT&quot;</span>] = args.port</span><br><span class="line">  	<span class="comment"># 如果不指定 host=&#x27;0.0.0.0&#x27;，那么只能通过 127.0.0.1:port 才能访问</span></span><br><span class="line">    <span class="comment"># 使用 ifconfig 查到的 ip:port 方式无法访问</span></span><br><span class="line">    <span class="comment"># 报错: curl: (7) Failed to connect to ip port xxx after 7 ms: Couldn&#x27;t connect to server</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=args.port)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>关于 <code>host</code> 配置，flask 源码介绍如下</p>
<blockquote>
<p>:param host: the hostname to listen on. Set this to <code>&#39;0.0.0.0&#39;</code> to</p>
<p> have the server available externally as well. Defaults to</p>
<p> <code>&#39;127.0.0.1&#39;</code> or the host in the <code>SERVER_NAME</code> config variable</p>
<p> if present.</p>
</blockquote>
</li>
</ul>
</li>
<li><p>Nginx backup，可通过<code>curl http://localhost:7890</code>进行测试，7890即启动容器时映射的端口，首先都会尝试访问主</p>
<ul>
<li><p>主可用时，不会访问 backup</p>
</li>
<li><p>主不可用时，轮询访问 backup，每次一个，如果上一个 backup 不可用，才会到下一个 backup，<a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html">官方介绍</a></p>
<blockquote>
<p>By default, requests are distributed between the servers using a weighted round-robin balancing method. In the above example, each 7 requests will be distributed as follows: 5 requests go to <code>backend1.example.com</code> and one request to each of the second and third servers. If an error occurs during communication with a server, the request will be passed to the next server, and so on until all of the functioning servers will be tried. If a successful response could not be obtained from any of the servers, the client will receive the result of the communication with the last server.</p>
</blockquote>
</li>
<li><p>假设一主三备</p>
<ol>
<li>前五次访问，主可用，一直访问主</li>
<li>第六次访问时，主不可用，访问备 A</li>
<li>第七次访问时，主可用，访问备 B</li>
<li>第八次访问时，主可用，访问主</li>
<li>第九次访问时，主不可用，访问备 C，如果备 C 不可用，则会依次轮训备 A 和备 B</li>
</ol>
</li>
</ul>
</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=fogbQqsNK7w">亲自动手搭建一个Nginx反向代理服务器</a></li>
<li><a target="_blank" rel="noopener" href="https://nginx.org/en/">Nginx官网</a></li>
<li>nginx一小时入门教程，<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1rG4y1e7BQ">视频</a>，<a target="_blank" rel="noopener" href="https://www.yuque.com/wukong-zorrm/cql6cz">笔记</a></li>
<li><a target="_blank" rel="noopener" href="https://help.superhosting.bg/en/cgi-common-gateway-interface-fastcgi.html">What is CGI, FastCGI?</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42303254/article/details/89503656">Linux下nginx.conf中 fastcgi_params和fastcgi.conf的区别</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f12c288b17ed">nginx 配置文件的介绍</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44750617/article/details/120738744">Nginx安装配置和常用使用（反向代理与负载均衡）</a></li>
<li><a target="_blank" rel="noopener" href="https://www.plesk.com/blog/various/nginx-configuration-guide/">NGINX Configuration Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://www.linode.com/docs/guides/how-to-configure-nginx/">How to Configure NGINX</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/zFtNE94zZXhmAKEDDR1QIA">Nginx常用配置及和基本功能讲解</a></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">cv-programmer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://bh.ecel.top/tools/The-trick-of-nginx/">http://bh.ecel.top/tools/The-trick-of-nginx/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://bh.ecel.top" target="_blank">cv-programmer</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/nginx/">nginx</a></div><div class="post_share"><div class="social-share" data-image="/image/nginx.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/tools/The-trick-of-apache/"><img class="prev-cover" src="/image/apache.jpeg" onerror="onerror=null;src='/image/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Apache使用说明</div></div></a></div><div class="next-post pull-right"><a href="/network/network-address-translation/"><img class="next-cover" src="/image/NAT.png" onerror="onerror=null;src='/image/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【转载】内网与公网如何相互访问</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/tutorial/Linux-bt-thinkphp/" title="【Linux】宝塔 + thinkphp"><img class="cover" src="/image/linux.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-01</div><div class="title">【Linux】宝塔 + thinkphp</div></div></a></div><div><a href="/tutorial/Linux-build-my-vps/" title="VPS"><img class="cover" src="/image/linux.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-26</div><div class="title">VPS</div></div></a></div><div><a href="/tutorial/Linux-install-Go-in-Linux/" title="【Linux】Go安装"><img class="cover" src="/image/linux.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-07</div><div class="title">【Linux】Go安装</div></div></a></div><div><a href="/tutorial/Linux-install-MySQL-in-Linux/" title="【Linux】MySQL安装"><img class="cover" src="/image/linux.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-23</div><div class="title">【Linux】MySQL安装</div></div></a></div><div><a href="/tutorial/Linux-install-docker-in-Linux/" title="【Linux】docker安装"><img class="cover" src="/image/docker.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-16</div><div class="title">【Linux】docker安装</div></div></a></div><div><a href="/tutorial/Linux-install-kafka-in-Linux/" title="【Linux】kafka安装"><img class="cover" src="/image/linux.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-23</div><div class="title">【Linux】kafka安装</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/image/avatar.jpg" onerror="this.onerror=null;this.src='/image/friend_404.gif'" alt="avatar"/><div class="author-info__name">cv-programmer</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">91</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">124</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/cv-programmer"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/cv-programmer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:usetologin@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">基础命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-number">2.3.</span> <span class="toc-text">内置变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.4.</span> <span class="toc-text">配置文件介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.4.2.</span> <span class="toc-text">配置文件详解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#location"><span class="toc-number">2.5.</span> <span class="toc-text">location</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upstream"><span class="toc-number">2.6.</span> <span class="toc-text">Upstream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#try-files"><span class="toc-number">2.7.</span> <span class="toc-text">try_files</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#return%E4%B8%8Erewrite"><span class="toc-number">2.8.</span> <span class="toc-text">return与rewrite</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#return"><span class="toc-number">2.8.1.</span> <span class="toc-text">return</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rewrite"><span class="toc-number">2.8.2.</span> <span class="toc-text">rewrite</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#last%E4%B8%8Ebreak"><span class="toc-number">2.9.</span> <span class="toc-text">last与break</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0%E5%8F%8A%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">3.1.</span> <span class="toc-text">概述及使用建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#conf-d%E5%92%8Csites-available"><span class="toc-number">3.1.1.</span> <span class="toc-text">conf.d和sites-available</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%AF%E7%BB%A7%E6%89%BF%E8%87%AA%E7%88%B6%E7%BA%A7"><span class="toc-number">3.1.2.</span> <span class="toc-text">重复的配置可继承自父级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%A6%81%E5%B0%86%E6%89%80%E6%9C%89%E8%AF%B7%E6%B1%82%E9%83%BD%E4%BB%A3%E7%90%86%E5%88%B0%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%EF%BC%89"><span class="toc-number">3.1.3.</span> <span class="toc-text">不要将所有请求都代理到后端服务器（动静分离）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E4%BD%BF%E7%94%A8try-files%E4%BB%A3%E6%9B%BFif-f"><span class="toc-number">3.1.4.</span> <span class="toc-text">检查文件是否存在使用try_files代替if -f</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E9%87%8D%E5%86%99%E8%B7%AF%E5%BE%84%E4%B8%AD%E5%8C%85%E5%90%ABhttp-%E6%88%96https"><span class="toc-number">3.1.5.</span> <span class="toc-text">在重写路径中包含http:&#x2F;&#x2F;或https:&#x2F;&#x2F;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE%EF%BC%88%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">通过域名访问（反向代理）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E4%BB%A3%E7%90%86"><span class="toc-number">3.2.1.</span> <span class="toc-text">HTTP代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9EHTTP%E4%BB%A3%E7%90%86"><span class="toc-number">3.2.2.</span> <span class="toc-text">非HTTP代理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSL%E8%AE%BE%E7%BD%AE%EF%BC%88HTTPS%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">SSL设置（HTTPS）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%81%E8%AE%B8%E4%B8%8E%E7%A6%81%E6%AD%A2IP"><span class="toc-number">3.4.</span> <span class="toc-text">允许与禁止IP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E8%BF%81%E7%A7%BB%EF%BC%8C%E4%B8%8D%E8%AE%A9%E7%94%A8%E6%88%B7%E6%94%B6%E8%97%8F%E7%9A%84%E9%93%BE%E6%8E%A5%E6%88%96%E8%80%85%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E7%9A%84%E9%93%BE%E6%8E%A5%E5%A4%B1%E6%95%88"><span class="toc-number">3.5.</span> <span class="toc-text">域名迁移，不让用户收藏的链接或者搜索引擎的链接失效</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AD%94%E7%96%91"><span class="toc-number">4.</span> <span class="toc-text">答疑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#fastcgi-params%E5%92%8Cfastcgi-conf%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">4.1.</span> <span class="toc-text">fastcgi_params和fastcgi.conf的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">4.2.</span> <span class="toc-text">转发和重定向</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">5.</span> <span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-number">6.</span> <span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E6%96%87%E4%BB%B6"><span class="toc-number">6.1.</span> <span class="toc-text">默认文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx-conf"><span class="toc-number">6.1.1.</span> <span class="toc-text">nginx.conf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#default"><span class="toc-number">6.1.2.</span> <span class="toc-text">default</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="toc-number">6.2.</span> <span class="toc-text">进程模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E4%B8%8Ebackup"><span class="toc-number">7.</span> <span class="toc-text">本地测试环境与backup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/tools/The-trick-of-ubuntu/" title="Ubuntu 常用技巧"><img src="/image/ubuntu.jpg" onerror="this.onerror=null;this.src='/image/404.jpg'" alt="Ubuntu 常用技巧"/></a><div class="content"><a class="title" href="/tools/The-trick-of-ubuntu/" title="Ubuntu 常用技巧">Ubuntu 常用技巧</a><time datetime="2025-05-11T03:17:02.000Z" title="发表于 2025-05-11 11:17:02">2025-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ai/n8n/" title="工作流之 n8n"><img src="/image/n8n-logo.png" onerror="this.onerror=null;this.src='/image/404.jpg'" alt="工作流之 n8n"/></a><div class="content"><a class="title" href="/ai/n8n/" title="工作流之 n8n">工作流之 n8n</a><time datetime="2025-04-04T14:04:06.000Z" title="发表于 2025-04-04 22:04:06">2025-04-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/codeLang/Go-07-delve/" title="【Go】07-调试工具 delve"><img src="/image/go.jpeg" onerror="this.onerror=null;this.src='/image/404.jpg'" alt="【Go】07-调试工具 delve"/></a><div class="content"><a class="title" href="/codeLang/Go-07-delve/" title="【Go】07-调试工具 delve">【Go】07-调试工具 delve</a><time datetime="2025-03-01T14:41:51.000Z" title="发表于 2025-03-01 22:41:51">2025-03-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/cloud/distribution-02-pull-cache/" title="【Distribution】02-mirror"><img src="/image/distribution-logo.svg" onerror="this.onerror=null;this.src='/image/404.jpg'" alt="【Distribution】02-mirror"/></a><div class="content"><a class="title" href="/cloud/distribution-02-pull-cache/" title="【Distribution】02-mirror">【Distribution】02-mirror</a><time datetime="2025-01-11T15:38:39.000Z" title="发表于 2025-01-11 23:38:39">2025-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/codeLang/Go-06-cobra/" title="【Go】06-Cobra"><img src="/image/go.jpeg" onerror="this.onerror=null;this.src='/image/404.jpg'" alt="【Go】06-Cobra"/></a><div class="content"><a class="title" href="/codeLang/Go-06-cobra/" title="【Go】06-Cobra">【Go】06-Cobra</a><time datetime="2025-01-11T13:55:29.000Z" title="发表于 2025-01-11 21:55:29">2025-01-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/image/nginx.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By cv-programmer</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>